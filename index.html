<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UEH Food Map</title>

<!-- Fonts -->
<style>
@font-face{font-family:'Anton';src:url('Anton-Regular.ttf') format('truetype');font-display:swap}
@font-face{font-family:'Russo One';src:url('RussoOne-Regular.ttf') format('truetype');font-weight:700;font-display:swap}
</style>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&family=Baloo+2:wght@700;800&display=swap" rel="stylesheet"/>

<style>
:root{
  --c-orange:#FF7A45;
  --c-lemon:#FFD34A;
  --c-blue:#8CC3FF;
  --c-blue-deep:#1F3FAF;
  --c-pink:#FFC5E1;
  --c-white:#FFFFFF;
  --c-ink:#24303F;
  --c-mute:#6B7A90;
  --shadow-chunky: 0 6px 0 rgba(36,48,63,.22), 0 14px 28px rgba(36,48,63,.08);
  --shadow-soft: 0 12px 30px rgba(36,48,63,.12);
}

/* N·ªÅn trang h·ªìng ƒë·ªìng nh·∫•t */
html,body{height:100%;margin:0}
body{font-family:"Nunito",system-ui;color:var(--c-ink);background:#FAD0E6}

/* NAV */
.container{max-width:1360px;margin:0 auto;padding:0 24px}
.nav{position:sticky;top:0;z-index:80;background:linear-gradient(180deg,rgba(255,255,255,.95),rgba(255,255,255,.9));backdrop-filter:blur(10px);border-bottom:2px solid rgba(36,48,63,.1)}
.nav-wrap{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
.brand{display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit}
.brand-logo{width:56px;height:56px;border-radius:16px;background:var(--c-blue);box-shadow:var(--shadow-chunky);display:grid;place-items:center;overflow:hidden}
.brand span{font-family:'Anton',sans-serif;font-size:30px;letter-spacing:.3px}
.tabs{display:flex;gap:16px;align-items:center;flex-wrap:wrap}
.tab{font-family:'Anton',sans-serif;padding:12px 22px;border-radius:20px/22px;background:var(--c-pink);color:var(--c-ink);border:3px solid rgba(36,48,63,.24);text-decoration:none;font-size:18px;font-weight:800;box-shadow:var(--shadow-chunky);transition:transform .12s ease,background .12s ease}
.tab:hover{transform:translateY(-2px)} .tab.active{background:var(--c-lemon)}
.tab-dd{position:relative}
.menu{position:absolute;top:calc(100% + 10px);left:0;min-width:260px;z-index:95;background:#fff;border:3px solid rgba(36,48,63,.24);border-radius:18px;padding:10px 8px;box-shadow:var(--shadow-soft);display:none;font-family:'Anton',sans-serif}
.menu.open{display:block} .menu a{display:block;padding:12px 14px;border-radius:12px;color:var(--c-ink);text-decoration:none}
.menu a:hover{background:#FFF7C8;transform:translateX(4px)}
#btnOpenAuth{font-family:'Anton',sans-serif;padding:10px 18px;border-radius:16px;background:var(--c-blue);color:#0E4B5B;border:3px solid rgba(36,48,63,.24);font-weight:900;box-shadow:var(--shadow-chunky);cursor:pointer}

/* TITLES */
.titlebar h1{
  font-family:'Baloo 2', cursive;
  font-weight:800;
  font-size:48px;
  margin:20px 0 12px;
  letter-spacing:.5px;
  line-height:1.05;
  background:linear-gradient(90deg,#0E2E99,var(--c-blue-deep) 60%,#2A6CE6);
  -webkit-background-clip:text;
  color:transparent;
}

/* HOME */
.stage{background:#FFB4A2;border-radius:28px;padding:28px 24px 36px;box-shadow:var(--shadow-soft);position:relative;overflow:hidden}
.hero{position:relative;border-radius:22px;overflow:hidden;box-shadow:var(--shadow-soft);background:transparent;margin-bottom:18px}
.hero-viewport{width:100%;aspect-ratio:21/9;max-height:440px;overflow:hidden}
.hero-track{display:flex;height:100%;transition:transform .55s cubic-bezier(.22,.61,.36,1)}
.stage .hero-slide{
  position:relative;
  border-radius:20px;
  overflow:hidden;
  background:linear-gradient(180deg,#E7F1FF,#E9FFF6); /* gradient only for the running slider */
  min-width:100%;
  height:100%;
}
.hero-slide img{width:100%;height:100%;object-fit:contain}
.hero-cap{position:absolute;left:18px;bottom:18px;background:rgba(255,255,255,.92);border:3px solid rgba(36,48,63,.18);border-radius:16px;padding:8px 14px;font:800 22px "Baloo 2";box-shadow:var(--shadow-soft)}
.navbtn{position:absolute;top:50%;transform:translateY(-50%);width:46px;height:46px;border-radius:16px;border:2px solid rgba(36,48,63,.15);cursor:pointer;background:#fff;box-shadow:var(--shadow-soft)}
.prev{left:16px}.next{right:16px}
.pager {
  position: absolute;
  left: 50%;
  bottom: 12px;
  transform: translateX(-50%);
  display: flex;
  gap: 8px;
  background: transparent; /* b·ªè n·ªÅn ƒëen m·ªù */
  padding: 0;
}

.dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #bbb;
  border: none; /* b·ªè vi·ªÅn tr·∫Øng */
  opacity: 0.8;
  transition: background 0.2s ease, transform 0.2s ease;
}

.dot.active {
  background: #fff; /* ch·∫•m s√°ng nh∆∞ ·∫£nh 1 */
  transform: scale(1.2);
  opacity: 1;
}
.search{position:relative;margin:6px 0 8px}
.search input{width:100%;height:56px;border-radius:999px;border:3px solid var(--c-lemon);padding:0 56px;font-size:18px;background:#fff;box-shadow:var(--shadow-soft)}
.search .icon{position:absolute;left:18px;top:50%;transform:translateY(-50%);opacity:.7}

/* campus pills */
.campus-row{display:flex;gap:16px;flex-wrap:wrap;margin:14px 2px 20px}
.camp-pill{display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border-radius:999px;background:#ECEFF3;color:#1a1f2b;border:3px solid rgba(36,48,63,.2);box-shadow:var(--shadow-chunky);font-weight:900;cursor:pointer}
.camp-pill.locked{opacity:.85} .camp-pill.active{background:var(--c-lemon)}

/* Cards */
.grid{display:grid;gap:22px;grid-template-columns:repeat(4,minmax(0,1fr))}
@media (max-width:1200px){.grid{grid-template-columns:repeat(3,1fr)}} @media (max-width:880px){.grid{grid-template-columns:repeat(2,1fr)}} @media (max-width:540px){.grid{grid-template-columns:1fr}}
.card{background:#fff;border:3px solid rgba(36,48,63,.18);border-radius:26px;overflow:hidden;box-shadow:var(--shadow-soft);display:flex;flex-direction:column;cursor:pointer;transition:transform .18s}
.card:hover{transform:translateY(-3px)}
.thumb{position:relative}
.thumb img{width:100%;height:160px;object-fit:cover}
.rating{position:absolute;top:10px;right:10px;background:var(--c-ink);color:#fff;padding:6px 10px;border-radius:999px;font-weight:900;border:2px solid #fff;cursor:pointer}
.pillwrap{position:absolute;left:10px;bottom:10px;display:flex;gap:8px}
.pill{background:#111;color:#fff;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:800;border:2px solid #fff}
.body{padding:14px 16px}
.name{font:800 20px "Baloo 2"} .meta{color:var(--c-mute);font-size:14px}
.show-more{display:block;margin:24px auto 0;background:var(--c-lemon);border:3px solid rgba(36,48,63,.18);border-radius:999px;padding:12px 22px;font-weight:900;cursor:pointer}
.card.hidden{display:none!important}

/* RANKING */
.y2k-rank{display:grid;gap:24px}
.podium{display:grid;grid-template-columns:1.1fr 1.3fr 1.1fr;gap:24px;align-items:end}
.p-tile{background:#fff;border:3px solid rgba(36,48,63,.18);border-radius:22px;box-shadow:var(--shadow-soft);overflow:hidden;display:flex;flex-direction:column;align-items:center;cursor:pointer}
.p-head{width:100%;height:78px;display:grid;place-items:center;position:relative}
.p-head .medal{position:absolute;top:10px;left:50%;transform:translateX(-50%);background:var(--c-blue);border:3px solid rgba(36,48,63,.18);width:40px;height:40px;display:grid;place-items:center;border-radius:10px;font-family:'Anton'}
.p-body{width:100%;background:#fff;padding:12px 10px;text-align:center}
.p-body .star{display:inline-flex;align-items:center;gap:6px;margin-top:6px;color:#F59F00;font-weight:900}
.p-photo{width:100%;object-fit:cover}

.podium .tile-1 .p-head{background:var(--c-lemon)} /* top1 */
.podium .tile-0 .p-head{background:#CFE2FF}      /* top2 */
.podium .tile-2 .p-head{background:#FF9EC1}      /* top3 */

/* --- RANK ROLL (items #4, #5...) --- */
.rank-roll{display:grid;gap:22px;margin-top:8px}
.r-item{display:flex;align-items:center;gap:16px;background:#fff;border:3px solid rgba(36,48,63,.18);border-radius:28px;box-shadow:var(--shadow-soft);padding:16px 20px}
.r-no{min-width:72px;height:72px;border-radius:20px;display:grid;place-items:center;background:#FFC5E1;border:3px solid rgba(36,48,63,.18);font:900 28px "Baloo 2";color:#24303F}
.r-photo{width:72px;height:72px;border-radius:16px;object-fit:cover;border:3px solid rgba(36,48,63,.18);box-shadow:var(--shadow-soft)}
.r-meta{flex:1}
.r-meta .r-name{font:900 28px "Baloo 2";line-height:1.1}
.r-meta .r-addr{color:var(--c-mute);font-size:18px;margin-top:6px}
.r-score{margin-left:auto;background:var(--c-lemon);border:3px solid rgba(36,48,63,.18);border-radius:18px;padding:10px 16px;font-weight:900;display:inline-flex;align-items:center;gap:8px}

/* MAP ‚Äî UI tƒ©nh nh∆∞ ·∫£nh m·∫´u (kh√¥ng d√πng ·∫£nh map c≈©) */
.map-hero{background:linear-gradient(180deg,#FFEAD5,#FFF6E3);border:3px solid rgba(36,48,63,.18);border-radius:22px;box-shadow:var(--shadow-soft);padding:22px 22px 12px;margin-bottom:0}
.map-board{position:relative;height:460px;border-radius:18px;border:3px dashed rgba(36,48,63,.25);display:grid;place-items:center;background:#eee url('map.jpg') center/cover no-repeat;overflow:hidden;margin-bottom:28px}
@media (max-width: 900px){.map-board{height:360px}}
@media (max-width: 560px){.map-board{height:300px}}
.pin{width:88px;height:88px;background:#FF6699;border:4px solid #fff;border-radius:50%;box-shadow:0 14px 28px rgba(0,0,0,.25)}
.map-actions{display:flex;gap:10px;margin-top:12px;justify-content:center}
.map-btn{padding:10px 16px;border-radius:14px;border:3px solid rgba(36,48,63,.18);background:#fff;font-weight:900;box-shadow:var(--shadow-soft);cursor:pointer}
.map-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:18px;margin-top:24px}
.stat{background:#fff;border:3px solid rgba(36,48,63,.18);border-radius:18px;padding:18px;display:grid;place-items:center;box-shadow:var(--shadow-soft)}
.map-tip{margin-top:14px;background:#CFF6C9;border:3px solid rgba(36,48,63,.2);border-radius:18px;padding:12px 16px}

/* CHAT */
.chat-wrap{background:#fff;border:3px solid rgba(36,48,63,.18);border-radius:20px;box-shadow:var(--shadow-soft);padding:0}
.chat-head{background:linear-gradient(180deg,var(--c-orange),#FFB188);color:#132D31;padding:14px 16px;border-bottom:3px solid rgba(36,48,63,.18);border-radius:18px 18px 0 0}
.chat-head b{font-family:'Anton';letter-spacing:.5px}
.chat-body{padding:14px 12px;height:280px;overflow:auto;background:linear-gradient(180deg,#F7FBFF,#FFEFF8)}
.msg{background:#fff;border:2px dashed rgba(36,48,63,.24);border-radius:16px;padding:10px 12px;margin:8px 0}
.msg.me{background:#C8F3D2}
.chips{display:flex;flex-wrap:wrap;gap:10px;padding:12px;border-top:3px solid rgba(36,48,63,.12)}
.chip{padding:8px 12px;border-radius:999px;border:2px solid rgba(36,48,63,.18);background:#FFF7C8;font-weight:800;cursor:pointer}
.chat-input{display:flex;gap:8px;padding:12px;border-top:3px solid rgba(36,48,63,.12)}
.chat-input input{flex:1;height:46px;border-radius:12px;border:3px solid rgba(36,48,63,.18);padding:0 12px;background:#fff}
.chat-send{background:var(--c-blue);color:#0E4B5B;border:3px solid rgba(36,48,63,.2);border-radius:12px;padding:8px 14px;font-weight:900;cursor:pointer}

/* MODALS chung */
.auth{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:130;background:rgba(0,0,0,.45)}
.auth.show{display:flex}
.auth-card{background:#fff;border:3px solid rgba(36,48,63,.2);border-radius:22px;max-width:560px;width:100%;box-shadow:var(--shadow-soft)}
.auth-header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:2px dashed var(--c-lemon)}
.auth-body{padding:16px}
.btn{border:3px solid rgba(36,48,63,.2);border-radius:12px;padding:8px 14px;cursor:pointer;font-weight:900}
.btn.primary{background:linear-gradient(#FFE06A,#FFD34A)} .btn.light{background:#EEF7FB}

/* Fade */
section[hidden]{display:none!important}
section,.auth-card,.menu,.card,.p-tile,.r-item,.chat-wrap{animation:fadeIn .25s ease both}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
footer{text-align:center;padding:36px 0;color:var(--c-mute);font-family:"Baloo 2";font-weight:800}
.hidden{display:none!important}
/* ===== FIX layout form ƒëƒÉng nh·∫≠p (modal) ===== */
.auth .field{
  display:flex !important;
  flex-direction:column !important;
  gap:8px !important;
  margin-bottom:12px !important;
}
.auth .field label{
  font-weight:800 !important;
  color:#24303F !important;
}
.auth .field input,
.auth .field select{
  width:100% !important;
  height:44px !important;
  padding:0 12px !important;
  border:3px solid rgba(36,48,63,.22) !important;
  border-radius:12px !important;
  box-sizing:border-box !important;
  background:#fff !important;
}
.auth .auth-actions{
  display:flex !important;
  justify-content:flex-end !important;
  gap:10px !important;
  margin-top:10px !important;
}
.auth{display:none;align-items:center;justify-content:center;}
.auth.show{display:flex;}
.auth-card{max-width:560px;width:100%;}
/* Detail Modal sizing */
#modal .auth-card{max-width:640px;width:100%}
#modal .auth-body{max-height:70vh;overflow:auto}
#modal .auth-header{position:sticky;top:0;background:#fff;z-index:2}
/* Menu gallery: supports 1‚Äì2 images */
#modal .menu-gallery{display:grid;gap:10px;grid-template-columns:1fr}
@media(min-width:700px){#modal .menu-gallery{grid-template-columns:1fr 1fr}}
#modal .menu-gallery img{width:100%;height:auto;max-height:42vh;object-fit:contain;border-radius:10px;display:block}

/* Detail tabs */
#modal .dlg-tabs{display:flex;gap:8px;border-bottom:2px dashed rgba(36,48,63,.15);padding-bottom:8px;margin-top:14px}
#modal .dlg-tab{padding:8px 12px;border-radius:10px;border:3px solid rgba(36,48,63,.18);background:#FFF7C8;font-weight:900;cursor:pointer}
#modal .dlg-tab.active{background:var(--c-lemon)}
#modal .dlg-tabpanes{margin-top:12px}
#modal .dlg-pane{display:none}
#modal .dlg-pane.active{display:block}
/* Auth extras */
.auth-links{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
.auth-links .link{background:transparent;border:0;color:#1F3FAF;font-weight:900;cursor:pointer;padding:8px 0}
.auth-divider{height:1px;background:rgba(36,48,63,.12);margin:12px 0}
.auth-extra-actions{display:flex;justify-content:center}
.auth-extra-actions .btn.create{background:#CFF6C9;border-color:rgba(36,48,63,.2)}
/* ===== FIX layout ph·∫ßn "ƒêƒÉng T·∫£i Qu√°n ƒÇn" ===== */
#post .field{
  display:flex !important;
  flex-direction:column !important;
  gap:8px !important;
  margin-bottom:14px !important;
}

#post .field label{
  font-weight:800 !important;
  color:#24303F !important;
}

#post .field input,
#post .field select{
  width:100% !important;
  height:44px !important;
  padding:0 12px !important;
  border:3px solid rgba(36,48,63,.22) !important;
  border-radius:12px !important;
  background:#fff !important;
  box-sizing:border-box !important;
}

/* Gi·ªØ b·ªë c·ª•c 2 c·ªôt nh∆∞ng label kh√¥ng d√≠nh input */
#post .card{
  display:flex;
  flex-direction:column;
  justify-content:flex-start;
  gap:8px;
}
</style>
</head>
<body>

<!-- NAV -->
<nav class="nav">
  <div class="container nav-wrap">
    <a class="brand" href="#home"><div class="brand-logo"><img src="logo-pho.png" alt="" style="width:46px;height:46px;object-fit:cover;border-radius:12px"/></div><span>UEH Food Map</span></a>
    <div class="tabs" role="tablist">
      <div class="tab-dd">
        <button class="tab" id="tabHomeBtn">Trang ch·ªß ‚ñæ</button>
        <div class="menu" id="homeMenu" role="menu">
          <a href="#" data-cat="all">T·∫•t c·∫£</a><a href="#" data-cat="com">C∆°m</a><a href="#" data-cat="bun">B√∫n/M√¨/Ph·ªü</a><a href="#" data-cat="fast">ƒê·ªì ƒÉn nhanh</a><a href="#" data-cat="other">Kh√°c</a><a href="#" data-cat="drink">ƒê·ªì u·ªëng</a>
        </div>
      </div>
      <a class="tab" href="#rank" id="tabRank">Ranking: Top 5 tu·∫ßn</a>
      <a class="tab" href="#map">B·∫£n ƒë·ªì t∆∞∆°ng t√°c</a>
      <a class="tab" href="#post" id="tabPost">ƒêƒÉng t·∫£i</a>
      <a class="tab" href="#approve" id="tabApprove" style="display:none">Duy·ªát</a>
      <a class="tab" href="#chat">AI Chatbot</a>
    </div>
    <button id="btnOpenAuth">ƒêƒÉng nh·∫≠p</button>
  </div>
</nav>

<!-- HOME -->
<section class="container" id="home">
  <div class="titlebar"><h1>Top qu√°n ƒÉn must try</h1></div>
  <div class="stage">
    <div class="hero" aria-label="Top 5 qu√°n tu·∫ßn">
      <div class="hero-viewport"><div class="hero-track" id="heroTrack"></div></div>
      <button class="navbtn prev" id="heroPrev">‚óÄ</button>
      <button class="navbtn next" id="heroNext">‚ñ∂</button>
      <div class="pager" id="heroPager"></div>
    </div>

    <div class="search">
      <svg class="icon" width="22" height="22" viewBox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-opacity=".8" stroke-width="2"/><path d="M20 20l-3.5-3.5" stroke="currentColor" stroke-opacity=".8" stroke-width="2" stroke-linecap="round"/></svg>
      <input id="search" type="text" placeholder="T√¨m ki·∫øm qu√°n ƒÉn, ƒë·ªãa ch·ªâ‚Ä¶"/>
    </div>

    <!-- C∆° s·ªü -->
    <div class="campus-row" id="campusRow"></div>

    <div class="grid" id="cards"></div>
    <button class="show-more" id="btnMore" hidden>Xem th√™m</button>
  </div>
</section>

<!-- RANK -->
<section class="container" id="rank" hidden>
  <div class="titlebar"><h1>B·∫£ng X·∫øp H·∫°ng Tu·∫ßn</h1></div>
  <div class="y2k-rank">
    <div class="podium" id="rankPodium"></div>
    <div class="rank-roll" id="rankRoll"></div>
  </div>
</section>

<!-- MAP -->
<section class="container" id="map" hidden>
  <div class="titlebar"><h1>B·∫£n ƒë·ªì t∆∞∆°ng t√°c</h1></div>
  <div class="map-hero">
    <div class="map-board">
      <div style="text-align:center">
        <div style="margin-top:10px;font-weight:900">B·∫£n ƒë·ªì ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn‚Ä¶</div>
        <div class="map-actions">
          <button class="map-btn">üìç Kh√°m ph√° ngay</button>
          <button class="map-btn">üëâ H∆∞·ªõng d·∫´n</button>
        </div>
      </div>
    </div>
    <div class="map-stats">
      <div class="stat">üç± Qu√°n ƒÉn <br><b>50+</b></div>
      <div class="stat">‚òï Qu√°n cafe <br><b>30+</b></div>
      <div class="stat">üç∞ Tr√°ng mi·ªáng <br><b>20+</b></div>
    </div>
    <div class="map-tip">üí° <b>M·∫πo nh·ªè:</b> d√πng b·ªô l·ªçc ƒë·ªÉ t√¨m theo kho·∫£ng c√°ch, gi√° c·∫£ v√† lo·∫°i m√≥n y√™u th√≠ch nh√©!</div>
  </div>
</section>

<!-- POST -->
<section class="container" id="post" hidden>
  <div class="titlebar"><h1>ƒêƒÉng T·∫£i Qu√°n ƒÇn</h1></div>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px">
    <div class="card" style="padding:18px">
      <div class="auth-body" style="padding:0">
        <div class="field"><label>T√™n qu√°n ƒÉn</label><input id="pName" placeholder="VD: B√∫n B√≤ Hu·∫ø O Ty"/></div>
        <div class="field"><label>ƒê·ªãa ch·ªâ</label><input id="pAddr" placeholder="VD: 123 Nguy·ªÖn Tri Ph∆∞∆°ng, P.5, Q.10"/></div>
        <div class="field" style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
          <div><label>Gi√° t·ª´ (VND)</label><input id="pMin" type="number" min="0" placeholder="25000"/></div>
          <div><label>ƒë·∫øn (VND)</label><input id="pMax" type="number" min="0" placeholder="60000"/></div>
        </div>
        <div class="field"><label>Lo·∫°i</label>
          <select id="pCat" style="height:46px;border:3px solid rgba(36,48,63,.18);border-radius:12px;padding:0 12px">
            <option value="com">C∆°m</option><option value="bun">B√∫n/M√¨/Ph·ªü</option><option value="fast">ƒê·ªì ƒÉn nhanh</option><option value="other">Kh√°c</option><option value="drink">ƒê·ªì u·ªëng</option>
          </select>
        </div>
        <button class="show-more" id="btnSubmitPost" style="width:100%">G·ª≠i ƒê·ªÅ Xu·∫•t</button>
      </div>
    </div>
    <div class="card" style="padding:18px">
      <h3 style="margin:4px 0 12px">L·ªãch s·ª≠ ƒë·ªÅ xu·∫•t</h3>
      <div id="historyBox" style="color:var(--c-mute)">B·∫°n ch∆∞a c√≥ ƒë·ªÅ xu·∫•t n√†o.</div>
    </div>
  </div>
</section>

<!-- APPROVE -->
<section class="container" id="approve" hidden>
  <div class="titlebar"><h1>Duy·ªát ƒê·ªÅ Xu·∫•t</h1></div>
  <div class="card" id="approveList" style="padding:16px">Ch∆∞a c√≥ ƒë·ªÅ xu·∫•t ch·ªù duy·ªát.</div>
</section>

<!-- CHAT -->
<section class="container" id="chat" hidden>
  <div class="titlebar"><h1>AI Chatbot</h1></div>
  <div class="chat-wrap">
    <div class="chat-head"><b>UEH Food Bot</b> ‚Äî ƒêang ho·∫°t ƒë·ªông ‚ú®</div>
    <div class="chat-body" id="chatLog"></div>
    <div class="chips">
      <button class="chip">üçú Qu√°n b√∫n g·∫ßn ƒë√¢y</button>
      <button class="chip">‚òï Qu√°n cafe y√™n tƒ©nh</button>
      <button class="chip">üí∏ Qu√°n ƒÉn gi√° r·∫ª</button>
      <button class="chip">üèÜ Top qu√°n ngon nh·∫•t</button>
    </div>
    <div class="chat-input">
      <input id="chatInput" placeholder="B·∫°n mu·ªën ƒÉn g√¨ h√¥m nay?"/>
      <button class="chat-send" id="chatSend">G·ª≠i</button>
    </div>
  </div>
</section>

<!-- DETAIL -->
<div class="auth hidden" id="modal">
  <div class="auth-card" style="max-width:760px">
    <div class="auth-header">
      <strong id="dlgTitle">Chi ti·∫øt qu√°n</strong>
      <button id="dlgClose" class="btn light">‚úï</button>
    </div>
    <div class="auth-body" id="dlgContent"></div>
  </div>
</div>

<!-- AUTH -->
<div class="auth" id="auth">
  <div class="auth-card" id="authCard" role="dialog" aria-modal="true">
    <div class="auth-header"><strong>T√†i kho·∫£n</strong><button id="authClose" class="btn light">‚úï</button></div>
    <div class="auth-body">
      <div id="paneLogin">
        <div class="field"><label>Email</label><input type="email" id="loginEmail" placeholder="email@example.com"></div>
        <div class="field"><label>M·∫≠t kh·∫©u</label><input type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
        <div class="auth-links">
          <button class="link" id="linkForgot">Qu√™n m·∫≠t kh·∫©u?</button>
          <button class="link" id="linkAdmin">Qu·∫£n tr·ªã vi√™n?</button>
        </div>
        <div class="auth-actions"><button class="btn light" id="loginCancel">Hu·ª∑</button><button class="btn primary" id="loginSubmit">ƒêƒÉng nh·∫≠p</button></div>
        <div class="auth-divider"></div>
        <div class="auth-extra-actions"><button class="btn create" id="btnCreate">T·∫°o t√†i kho·∫£n m·ªõi</button></div>
      </div>
      <div id="paneSignup" style="display:none">
        <div class="field"><label>H·ªç v√† t√™n</label><input type="text" id="suName" placeholder="Nguy·ªÖn VƒÉn A"></div>
        <div class="field"><label>Email</label><input type="email" id="suEmail" placeholder="you@example.com"></div>
        <div class="field"><label>SƒêT</label><input type="tel" id="suPhone" placeholder="09xx xxx xxx"></div>
        <div class="field"><label>M·∫≠t kh·∫©u</label><input type="password" id="suPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
        <div class="auth-actions"><button class="btn light" id="signupCancel">Hu·ª∑</button><button class="btn primary" id="signupSubmit">ƒêƒÉng k√Ω</button></div>
      </div>
      <div id="paneReset" style="display:none">
        <div class="field"><label>Email</label><input type="email" id="rpEmail" placeholder="you@example.com"></div>
        <div class="field"><label>M·∫≠t kh·∫©u m·ªõi</label><input type="password" id="rpPass1" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
        <div class="field"><label>X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label><input type="password" id="rpPass2" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
        <div class="auth-actions"><button class="btn light" id="resetCancel">Hu·ª∑</button><button class="btn primary" id="resetSubmit">ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u</button></div>
      </div>
    </div>
  </div>
</div>

<!-- MODAL m·ªü c∆° s·ªü (2 √¥ ch·ªçn, gi√° 20k) -->
<div class="auth" id="campModal">
  <div class="auth-card" style="max-width:680px">
    <div class="auth-header"><strong>ƒêƒÉng k√Ω m·ªü c∆° s·ªü</strong><button class="btn light" id="campClose">‚úï</button></div>
    <div class="auth-body">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:12px">
        <div class="field" style="margin:0"><label>C∆° s·ªü</label><select id="selCampus" style="height:46px;border:3px dashed rgba(36,48,63,.5);border-radius:12px;padding:0 12px"></select></div>
        <div class="field" style="margin:0"><label>G√≥i</label><select id="selPack" style="height:46px;border:3px dashed rgba(36,48,63,.5);border-radius:12px;padding:0 12px"><option value="20k">M·ªü c∆° s·ªü ‚Äî 20.000ƒë</option></select></div>
      </div>
      <div style="display:flex;justify-content:flex-end"><button class="btn primary" id="campPay">Ti·∫øp t·ª•c ƒë·∫øn thanh to√°n</button></div>
    </div>
  </div>
</div>

<footer class="container">¬© 2025 UEH Food Map ‚Äì cute mode üßÉ</footer>

<script>
/* Router */
const sections=['home','rank','map','post','approve','chat'];
function navigate(){const hash=(location.hash||'#home').replace('#','');sections.forEach(id=>document.getElementById(id).hidden=(id!==hash));document.querySelectorAll('.tabs .tab').forEach(t=>t.classList.remove('active'));if(hash==='home')document.getElementById('tabHomeBtn').classList.add('active');else document.querySelector(`.tabs a[href="#${hash}"]`)?.classList.add('active');}
addEventListener('hashchange',navigate);navigate();

/* Data */
const DATA=[
  {id:1,slug:'bun-quay-tam-quan',name:'B√∫n Qu·∫≠y T√ÇM QU√ÅN',addr:'210 Nguy·ªÖn Tri Ph∆∞∆°ng',dist:'50m',price:'40-60k',rate:4.4,cat:'bun',campus:'B'},
  {id:2,slug:'rau-ma-mix',name:'Rau m√° mix',addr:'269 Nguy·ªÖn Tri Ph∆∞∆°ng',dist:'60m',price:'12-34k',rate:4.2,cat:'drink',campus:'B'},
  {id:3,slug:'chicken-plus',name:'Chicken Plus',addr:'226 Nguy·ªÖn Tri Ph∆∞∆°ng',dist:'120m',price:'100k/ng∆∞·ªùi',rate:4.2,cat:'fast',campus:'B'},
  {id:4,slug:'bun-thai',name:'B√∫n Th√°i',addr:'325 Nguy·ªÖn Tri Ph∆∞∆°ng',dist:'350m',price:'29-59k',rate:4.9,cat:'bun',campus:'B'},
  {id:5,slug:'bun-bo-phuong-ngoc',name:'B√∫n b√≤ Ph∆∞∆°ng Ng·ªçc',addr:'384 H√≤a H·∫£o',dist:'160m',price:'38-48k',rate:4.5,cat:'bun',campus:'B'},
  {id:6,slug:'quan-chay-an-cat-tuong',name:'Qu√°n chay An C√°t T∆∞·ªùng',addr:'218 Nguy·ªÖn Tri Ph∆∞∆°ng',dist:'100m',price:'49-86k',rate:4.3,cat:'other',campus:'B'},
  {id:7,slug:'com-tom-phu-trung',name:'C∆°m t√¥m ph·ªß tr·ª©ng',addr:'ƒê√†o Duy T·ª´',dist:'50m',price:'35-40k',rate:4.8,cat:'com',campus:'B'},
  {id:8,slug:'tra-sua-gia-nghi',name:'Tr√† S·ªØa Gia Nghi',addr:'415A H√≤a H·∫£o',dist:'170m',price:'‚Äî',rate:5.0,cat:'drink',campus:'B'},
  {id:9,slug:'yi-jia-desert',name:'Yi Jia Desert',addr:'363 Vƒ©nh Vi·ªÖn',dist:'450m',price:'25-48k',rate:4.3,cat:'other',campus:'B'},
  {id:10,slug:'tra-sua-tuyet-ngan',name:'Tr√† s·ªØa Tuy·∫øt Ng√¢n',addr:'208/20/8 Nguy·ªÖn Tri Ph∆∞∆°ng',dist:'280m',price:'28-78k',rate:4.1,cat:'drink',campus:'B'},
  {id:11,slug:'bun-dau-mam-tom-tien-hai',name:'B√∫n ƒë·∫≠u m·∫Øm t√¥m Ti·∫øn H·∫£i',addr:'409 Nguy·ªÖn Tri Ph∆∞∆°ng',dist:'450m',price:'22-100k',rate:4.1,cat:'bun',campus:'B'},
  {id:12,slug:'tra-sua-phuong-hoang',name:'Tr√† s·ªØa Ph∆∞·ª£ng Ho√†ng',addr:'317B Nguy·ªÖn Tri Ph∆∞∆°ng',dist:'80m',price:'25-35k',rate:4.3,cat:'drink',campus:'B'},
  {id:13,slug:'ha-cao-phanh',name:'H√° c·∫£o Ph√°nh',addr:'012 L√¥ B Chung c∆∞ Nguy·ªÖn Tr√£i',dist:'900m',price:'12-100k',rate:4.5,cat:'fast',campus:'B'},
  {id:14,slug:'com-ga-tam-ky',name:'C∆°m g√† Tam K·ª≥',addr:'65 ƒê√†o Duy T·ª´',dist:'30m',price:'35-50k',rate:4.6,cat:'com',campus:'B'},
  {id:15,slug:'bun-thai-com-viet',name:'B√∫n th√°i - C∆°m Vi·ªát',addr:'325 Nguy·ªÖn Tri Ph∆∞∆°ng',dist:'70m',price:'30-35k',rate:4.4,cat:'bun',campus:'B'},
  {id:16,slug:'sinh-to-hem',name:'Sinh t·ªë h·∫ªm',addr:'394 Ho√† H·∫£o',dist:'400m',price:'10-25k',rate:4.8,cat:'drink',campus:'B'},
  {id:17,slug:'bun-dau-non-la',name:'B√∫n ƒë·∫≠u N√≥n L√°',addr:'188 Nguy·ªÖn Tri Ph∆∞∆°ng',dist:'70m',price:'40-70k',rate:4.6,cat:'bun',campus:'B'}
];
const imgOf=s=>`${s}.jpg`;
// Reviews map: load from reviews.json; fallback to inline <script id="reviewsInline"> if fetch fails
let REVIEWS = {};
(function(){
  function tryInline(){
    const el = document.getElementById('reviewsInline');
    if(el){
      try {
        REVIEWS = JSON.parse(el.textContent || '{}');
        console.info('Loaded reviews from inline JSON');
      } catch(e){
        console.warn('Inline reviews parse error:', e);
      }
    }
  }
  fetch('reviews.json', { cache: 'no-store' })
    .then(r => r.ok ? r.json() : Promise.reject(new Error('HTTP '+r.status)))
    .then(j => { REVIEWS = j || {}; })
    .catch(err => {
      console.warn('Could not load reviews.json:', err);
      tryInline();
    });
})();

/* Hero */
const TOP5=[...DATA].sort((a,b)=>b.rate-a.rate).slice(0,5);
const heroTrack=document.getElementById('heroTrack'),heroPager=document.getElementById('heroPager');
TOP5.forEach((x,i)=>{heroTrack.insertAdjacentHTML('beforeend',`<div class="hero-slide"><img src="${imgOf(x.slug)}" alt="Top ${i+1}: ${x.name}" onerror="if(!this.dataset.fbk){this.dataset.fbk=1;this.src=this.src.replace('.jpg','.png');}"><div class="hero-cap">${x.name}</div></div>`);heroPager.insertAdjacentHTML('beforeend',`<button class="dot${i?'':' active'}" data-idx="${i}"></button>`);});
let heroIdx=0;function updateHero(){heroTrack.style.transform=`translateX(-${heroIdx*100}%)`;document.querySelectorAll('.dot').forEach((d,i)=>d.classList.toggle('active',i===heroIdx));}
document.getElementById('heroPrev').onclick=()=>{heroIdx=(heroIdx+TOP5.length-1)%TOP5.length;updateHero();}
document.getElementById('heroNext').onclick=()=>{heroIdx=(heroIdx+1)%TOP5.length;updateHero();}
setInterval(()=>{heroIdx=(heroIdx+1)%TOP5.length;updateHero();},5000);
heroPager.addEventListener('click',e=>{const b=e.target.closest('.dot');if(!b)return;heroIdx=+b.dataset.idx;updateHero();});

/* Grid + Search */
const grid=document.getElementById('cards'),btnMore=document.getElementById('btnMore');let currentCat='all',searchQuery='',expanded=false;
function formatCard(it){const price=it.price?.trim()?it.price:'‚Äî';return `<article class="card" data-id="${it.id}"><div class="thumb"><img src="${imgOf(it.slug)}" alt="${it.name}" loading="lazy" onerror="if(!this.dataset.fbk){this.dataset.fbk=1;this.src=this.src.replace('.jpg','.png');}"/><span class="rating">‚òÖ ${it.rate}</span><div class="pillwrap"><span class="pill">${it.dist}</span><span class="pill">${price}</span></div></div><div class="body"><div class="name">${it.name}</div><div class="meta">${it.addr}</div></div></article>`;}
function renderGrid(){const list=DATA.filter(x=>(currentCat==='all'||x.cat===currentCat)&&((x.name+' '+x.addr).toLowerCase().includes(searchQuery)));grid.innerHTML='';list.forEach((it,idx)=>{grid.insertAdjacentHTML('beforeend',formatCard(it));if(!expanded&&idx>=8)grid.lastElementChild.classList.add('hidden');});btnMore.hidden=list.length<=8;btnMore.textContent=expanded?'Thu g·ªçn':'Xem th√™m';}
btnMore.onclick=()=>{expanded=!expanded;grid.querySelectorAll('.card').forEach((c,i)=>c.classList.toggle('hidden',!expanded&&i>=8));btnMore.textContent=expanded?'Thu g·ªçn':'Xem th√™m';if(!expanded)scrollTo({top:document.getElementById('home').offsetTop-60,behavior:'smooth'})}
const searchInput=document.getElementById('search');let t=null;searchInput.addEventListener('input',()=>{clearTimeout(t);t=setTimeout(()=>{searchQuery=searchInput.value.trim().toLowerCase();expanded=false;renderGrid();},150);});renderGrid();
/* home dropdown */
const tabHomeBtn=document.getElementById('tabHomeBtn'),homeMenu=document.getElementById('homeMenu');
tabHomeBtn.addEventListener('click',(e)=>{e.stopPropagation();if(location.hash!=='#home')location.hash='#home';homeMenu.classList.toggle('open');});
homeMenu.querySelectorAll('a').forEach(a=>a.addEventListener('click',e=>{e.preventDefault();currentCat=a.dataset.cat||'all';expanded=false;homeMenu.classList.remove('open');renderGrid();}));
document.addEventListener('click',()=>homeMenu.classList.remove('open'));

/* Detail (rating c≈©ng m·ªü) + Menu */
const modal=document.getElementById('modal'),dlgContent=document.getElementById('dlgContent'),dlgTitle=document.getElementById('dlgTitle');
function closeModal(){modal.classList.add('hidden');}
document.getElementById('dlgClose').onclick=closeModal;
function openDetail(r){
  dlgTitle.textContent=r.name;
  dlgContent.innerHTML=`
    <img src="${imgOf(r.slug)}" alt="${r.name}" style="width:100%;height:auto;max-height:48vh;object-fit:contain;border-radius:12px;display:block" onerror="if(!this.dataset.fbk){this.dataset.fbk=1;this.src=this.src.replace('.jpg','.png');}"/>
    <div style="margin-top:12px">
      <div style="font:900 22px 'Baloo 2'">${r.name}</div>
      <div style="color:#64748b;margin:6px 0">${r.addr}</div>
      <div><strong>Gi√°:</strong> ${r.price||'‚Äî'}</div>
      <div><strong>Kho·∫£ng c√°ch:</strong> ${r.dist}</div>
      <div style="margin-top:8px"><strong>ƒê√°nh gi√°:</strong> ‚òÖ ${r.rate}</div>
    </div>

    <div class="dlg-tabs">
      <button class="dlg-tab active" data-pane="menu">üìñ Menu</button>
      <button class="dlg-tab" data-pane="overview">üìã T·ªïng quan</button>
      <button class="dlg-tab" data-pane="rate">‚≠ê ƒê√°nh gi√°</button>
    </div>
    <div class="dlg-tabpanes">
      <div class="dlg-pane active" data-pane="menu">
        <div class="menu-gallery">
          <img src="${imgOf(r.slug+"-menu")}" alt="Menu ${r.name}" onerror="if(!this.dataset.fbk){this.dataset.fbk=1;this.src=this.src.replace('.jpg','.png');} else { this.style.display='none'; }"/>
          <img src="${imgOf(r.slug+"-menu-2")}" alt="Menu ${r.name} (2)" onerror="if(!this.dataset.fbk){this.dataset.fbk=1;this.src=this.src.replace('.jpg','.png');} else { this.style.display='none'; }"/>
        </div>
        <div class="meta">Menu tham kh·∫£o</div>
      </div>
      <div class="dlg-pane" data-pane="overview">
        <div id="revBox"></div>
      </div>
      <div class="dlg-pane" data-pane="rate">
        <div id="revAction" style="margin-top:12px"></div>
      </div>
    </div>
  `;

  // Tab switching
  const tabs=dlgContent.querySelectorAll('.dlg-tab');
  const panes=dlgContent.querySelectorAll('.dlg-pane');
  tabs.forEach(btn=>{
    btn.addEventListener('click',()=>{
      tabs.forEach(b=>b.classList.remove('active'));
      panes.forEach(p=>p.classList.remove('active'));
      btn.classList.add('active');
      dlgContent.querySelector(`.dlg-pane[data-pane="${btn.dataset.pane}"]`).classList.add('active');
      if(btn.dataset.pane==='overview'){
        renderReviewsFor(r.slug);
      } else if(btn.dataset.pane==='rate'){
        renderReviewForm();
      }
    });
  });

  // Helper: format stars (n·∫øu c·∫ßn)
  function formatStars(rate){
    const n = Math.round(rate*2)/2;
    let s = '';
    for(let i=1;i<=5;i++){
      if(n>=i) s += '‚òÖ';
      else if(n>=i-0.5) s += '‚Ø™';
      else s += '‚òÜ';
    }
    return s;
  }
  // Render reviews for overview tab
  function renderReviewsFor(slug){
    const box = dlgContent.querySelector('#revBox');
    const arr = (REVIEWS && REVIEWS[slug]) ? REVIEWS[slug] : [];
    if(!box) return;
    if(arr && arr.length){
      box.innerHTML = arr.map(t=>`<div class="msg" style="margin-top:0;white-space:pre-line">${t}</div>`).join('');
    } else {
      box.innerHTML = `<div class="msg" style="margin-top:0">Ch∆∞a c√≥ ƒë√°nh gi√°. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n! ‚úçÔ∏è</div>`;
    }
  }
  // Render review form for rate tab
  function renderReviewForm(){
    const box = dlgContent.querySelector('#revAction');
    if(!box) return;
    if(sessionStorage.getItem('logged')==='1'){
      box.innerHTML = `
        <textarea id="reviewInput" rows="3" style="width:100%;border-radius:8px;border:2px solid #eee;padding:8px;resize:vertical" placeholder="Chia s·∫ª c·∫£m nh·∫≠n c·ªßa b·∫°n v·ªÅ qu√°n‚Ä¶"></textarea>
        <button id="reviewSubmit" class="btn primary" style="margin-top:8px">G·ª≠i ƒë√°nh gi√°</button>
      `;
      box.querySelector('#reviewSubmit').onclick = ()=>{
        const v = box.querySelector('#reviewInput').value.trim();
        if(!v){ alert('Vui l√≤ng nh·∫≠p n·ªôi dung ƒë√°nh gi√°!'); return; }
        if(!REVIEWS[r.slug]) REVIEWS[r.slug] = [];
        REVIEWS[r.slug].push(v);
        alert('ƒê√£ g·ª≠i ƒë√°nh gi√°!');
        box.querySelector('#reviewInput').value = '';
        renderReviewsFor(r.slug);
      };
    } else {
      box.innerHTML = `<div style="margin:12px 0">Vui l√≤ng <b>ƒëƒÉng nh·∫≠p</b> ƒë·ªÉ g·ª≠i ƒë√°nh gi√°.</div>`;
    }
  }
  // Pre-render: t·ªïng quan (danh s√°ch) ƒë·ªÉ khi user b·∫•m l√† c√≥ ngay
  renderReviewsFor(r.slug);
  // Form ch·ªâ render khi qua tab "ƒê√°nh gi√°"

  modal.classList.remove('hidden');
  modal.classList.add('show');
}
grid.addEventListener('click',e=>{const card=e.target.closest('.card');if(!card)return;const r=DATA.find(x=>x.id==card.dataset.id);if(r)openDetail(r);});
grid.addEventListener('click',e=>{if(e.target.closest('.rating')){const card=e.target.closest('.card');const r=DATA.find(x=>x.id==card.dataset.id);if(r)openDetail(r);}});

/* Ranking (#1 cao nh·∫•t) */
const rankPodium=document.getElementById('rankPodium'),rankRoll=document.getElementById('rankRoll');
function renderRank(){const top=[...DATA].sort((a,b)=>b.rate-a.rate).slice(0,5);const podium=[top[1],top[0],top[2]].filter(Boolean);const heights=[300,360,280],photoH=[170,200,150];rankPodium.innerHTML='';podium.forEach((r,i)=>{rankPodium.insertAdjacentHTML('beforeend',`<div class="p-tile tile-${i}" data-id="${r.id}" style="height:${heights[i]}px"><div class="p-head"><div class="medal">#${i===1?'1':(i===0?'2':'3')}</div></div><img class="p-photo" style="height:${photoH[i]}px" src="${imgOf(r.slug)}" alt="" onerror="if(!this.dataset.fbk){this.dataset.fbk=1;this.src=this.src.replace('.jpg','.png');}"><div class="p-body"><div style="font-weight:900">${r.name}</div><div class="star">‚≠ê ${r.rate}</div></div></div>`);});rankRoll.innerHTML='';top.slice(3).forEach((r,i)=>{rankRoll.insertAdjacentHTML('beforeend',`<div class="r-item" data-id="${r.id}"><div class="r-no">#${i+4}</div><img class="r-photo" src="${imgOf(r.slug)}" alt="" onerror="if(!this.dataset.fbk){this.dataset.fbk=1;this.src=this.src.replace('.jpg','.png');}"><div class="r-meta"><div class="r-name">${r.name}</div><div class="r-addr">${r.addr}</div></div><div class="r-score">‚≠ê ${r.rate}</div></div>`);});}
renderRank();

// Open detail from Ranking (podium & roll)
rankPodium.addEventListener('click',e=>{
  const tile=e.target.closest('.p-tile');
  if(!tile) return;
  const r=DATA.find(x=>x.id==tile.dataset.id);
  if(r) openDetail(r);
});
rankRoll.addEventListener('click',e=>{
  const item=e.target.closest('.r-item');
  if(!item) return;
  const r=DATA.find(x=>x.id==item.dataset.id);
  if(r) openDetail(r);
});

/* Post/Duy·ªát */
const SUB_KEY='uehSubmissions';const readSubs=()=>JSON.parse(localStorage.getItem(SUB_KEY)||'[]');const writeSubs=arr=>localStorage.setItem(SUB_KEY,JSON.stringify(arr));const historyBox=document.getElementById('historyBox');function nfmt(n){return(+n||0).toLocaleString('vi-VN');}
function renderHistory(){const list=readSubs().filter(s=>s.owner===sessionStorage.getItem('email'));historyBox.innerHTML=list.length?list.map(s=>`<div class="msg"><b>${s.name}</b> ‚Äì ${s.addr}<br/>Gi√°: ${nfmt(s.min)} - ${nfmt(s.max)} VND ¬∑ Lo·∫°i: ${s.cat.toUpperCase()} ¬∑ <i>${s.status}</i></div>`).join(''):'B·∫°n ch∆∞a c√≥ ƒë·ªÅ xu·∫•t n√†o.'}
document.getElementById('btnSubmitPost').onclick=()=>{const name=document.getElementById('pName').value.trim();const addr=document.getElementById('pAddr').value.trim();const min=document.getElementById('pMin').value.trim();const max=document.getElementById('pMax').value.trim();const cat=document.getElementById('pCat').value;if(!name||!addr||!min||!max){alert('ƒêi·ªÅn ƒë·ªß T√™n/ƒê·ªãa ch·ªâ/Gi√°.');return;}const subs=readSubs();subs.push({id:Date.now(),owner:sessionStorage.getItem('email'),name,addr,min,max,cat,status:'ch·ªù duy·ªát'});
writeSubs(subs);
renderHistory();
if(typeof renderApprove==='function') renderApprove(); // c·∫≠p nh·∫≠t Duy·ªát ngay n·∫øu ƒëang m·ªü
alert('ƒê√£ g·ª≠i ƒë·ªÅ xu·∫•t!');
};
const approveList=document.getElementById('approveList');function renderApprove(){const arr=readSubs();approveList.innerHTML=arr.length?arr.map(s=>`<div class="r-item" style="align-items:flex-start"><div class="r-meta" style="flex:1"><b>${s.name}</b> ‚Äì ${s.addr}<br/>Gi√°: ${nfmt(s.min)} - ${nfmt(s.max)} VND ¬∑ Lo·∫°i: ${s.cat.toUpperCase()} ¬∑ <i>${s.status}</i></div><button class="btn primary" data-act="ok" data-id="${s.id}">Duy·ªát</button><button class="btn light" data-act="no" data-id="${s.id}">T·ª´ ch·ªëi</button></div>`).join(''):'Ch∆∞a c√≥ ƒë·ªÅ xu·∫•t ch·ªù duy·ªát.'}
approveList.addEventListener('click',e=>{const btn=e.target.closest('button');if(!btn)return;const id=+btn.dataset.id;const act=btn.dataset.act;const arr=readSubs();const it=arr.find(x=>x.id===id);if(!it)return;it.status=(act==='ok')?'ƒë√£ duy·ªát':'t·ª´ ch·ªëi';writeSubs(arr);renderApprove();if(act==='ok'){DATA.push({id:DATA.length+1,slug:'custom',name:it.name,addr:it.addr,dist:'‚Äî',price:`${nfmt(it.min)}-${nfmt(it.max)} VND`,rate:4.3,cat:it.cat,campus:'B'});renderGrid();renderRank();}});

/* Auth (ƒëƒÉng nh·∫≠p m·ªôt ph√°t) */
const auth=document.getElementById('auth'),btnOpenAuth=document.getElementById('btnOpenAuth');const authClose=document.getElementById('authClose'),loginCancel=document.getElementById('loginCancel')||{onclick:null};
function openAuth(){auth.classList.add('show');auth.style.display='flex'} function forceCloseAuth(){auth.classList.remove('show');auth.style.display='none'}
[authClose,loginCancel].forEach(b=>b&& (b.onclick=forceCloseAuth));
window.addEventListener('load',()=>{
  // Reset m·ªü kho√°: t·∫•t c·∫£ c∆° s·ªü ngo·∫°i tr·ª´ B ƒë·ªÅu kho√° m·∫∑c ƒë·ªãnh m·ªói l·∫ßn t·∫£i trang
  localStorage.removeItem('campUnlocked');
  updateNavbarByRole();
  renderCampusPills();
  if(sessionStorage.getItem('logged')==='1'){
    // ƒê√£ ƒëƒÉng nh·∫≠p: gi·ªØ nguy√™n, kh√¥ng t·ª± b·∫≠t modal
  } else {
    openAuth();
  }
});
btnOpenAuth.onclick=()=>{
  if(sessionStorage.getItem('logged')==='1'){
    // Logout: clear session & lock all campuses except B
    sessionStorage.clear();
    localStorage.removeItem('campUnlocked');
    activeCampus='B';
    renderCampusPills();
    if (typeof renderGrid==='function') renderGrid();
    updateNavbarByRole();
    location.hash = '#home'; // always return to homepage
    // Kh√¥ng m·ªü l·∫°i c·ª≠a s·ªï ƒëƒÉng nh·∫≠p sau khi ƒëƒÉng xu·∫•t
    forceCloseAuth();
  } else {
    openAuth();
  }
};
document.getElementById('loginSubmit').onclick=()=>{
  sessionStorage.setItem('logged','1');
  if(!sessionStorage.getItem('role')) sessionStorage.setItem('role','user');
  sessionStorage.setItem('email',document.getElementById('loginEmail').value.trim()||'user@example.com');
  updateNavbarByRole();
  alert('ƒêƒÉng nh·∫≠p th√†nh c√¥ng!');
  forceCloseAuth();
  // Always stay on Home page after login, regardless of role
  location.hash='#home';
  renderHistory();
};
function updateNavbarByRole(){const role=sessionStorage.getItem('role');const logged=sessionStorage.getItem('logged')==='1';document.getElementById('tabPost').style.display= logged && role!=='admin' ? '' : 'none';document.getElementById('tabApprove').style.display= logged && role==='admin' ? '' : 'none';btnOpenAuth.textContent= logged ? 'ƒêƒÉng xu·∫•t' : 'ƒêƒÉng nh·∫≠p';}

// Auth helpers
const linkForgot=document.getElementById('linkForgot');
const linkAdmin=document.getElementById('linkAdmin');
const btnCreate=document.getElementById('btnCreate');
linkForgot.onclick=()=>{ showAuthPane('reset'); };
linkAdmin.onclick=()=>{
  const code=prompt('Nh·∫≠p m√£ qu·∫£n tr·ªã vi√™n:');
  if(code && code.trim()==='000'){
    // K√≠ch ho·∫°t QTV v√† coi nh∆∞ ƒë√£ ƒëƒÉng nh·∫≠p ƒë·ªÉ n√∫t ƒë·ªïi th√†nh ‚ÄúƒêƒÉng xu·∫•t‚Äù
    sessionStorage.setItem('role','admin');
    sessionStorage.setItem('logged','1');
    updateNavbarByRole();
    alert('K√≠ch ho·∫°t ch·∫ø ƒë·ªô Qu·∫£n tr·ªã vi√™n!');
    forceCloseAuth();
    // Kh√¥ng t·ª± chuy·ªÉn tab
  } else if(code!==null){
    alert('M√£ kh√¥ng h·ª£p l·ªá!');
  }
};
btnCreate.onclick=()=>{ showAuthPane('signup'); };
function showAuthPane(which){
  const loginPane=document.getElementById('paneLogin');
  const signupPane=document.getElementById('paneSignup');
  const resetPane=document.getElementById('paneReset');
  if(!loginPane||!signupPane||!resetPane) return;
  // hide all first
  loginPane.style.display='none';
  signupPane.style.display='none';
  resetPane.style.display='none';
  // show selected
  if(which==='signup') signupPane.style.display='block';
  else if(which==='reset') resetPane.style.display='block';
  else loginPane.style.display='block';
  openAuth();
}
// only link back action (other signup functions s·∫Ω l√†m sau)
const signupCancel=document.getElementById('signupCancel')||{onclick:null};
if(signupCancel) signupCancel.onclick=()=>showAuthPane('login');

const signupSubmit=document.getElementById('signupSubmit')||{onclick:null};
if(signupSubmit) signupSubmit.onclick=()=>{
  const name=document.getElementById('suName').value.trim();
  const email=document.getElementById('suEmail').value.trim();
  const phone=document.getElementById('suPhone').value.trim();
  const pass=document.getElementById('suPass').value.trim();
  if(!name||!email||!phone||!pass){
    alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß H·ªç t√™n / Email / SƒêT / M·∫≠t kh·∫©u');
    return;
  }
  alert('T·∫°o t√†i kho·∫£n th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c.');
  showAuthPane('login');
  const le=document.getElementById('loginEmail');
  if(le) le.value=email; // g·ª£i √Ω s·∫µn email v·ª´a ƒëƒÉng k√Ω
};

// Reset password actions
const resetCancel=document.getElementById('resetCancel')||{onclick:null};
if(resetCancel) resetCancel.onclick=()=>showAuthPane('login');
const resetSubmit=document.getElementById('resetSubmit')||{onclick:null};
if(resetSubmit) resetSubmit.onclick=()=>{
  const email=document.getElementById('rpEmail').value.trim();
  const p1=document.getElementById('rpPass1').value.trim();
  const p2=document.getElementById('rpPass2').value.trim();
  if(!email||!p1||!p2){ alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß Email / M·∫≠t kh·∫©u m·ªõi / X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi'); return; }
  if(p1!==p2){ alert('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp'); return; }
  alert('ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c.');
  showAuthPane('login');
  const le=document.getElementById('loginEmail');
  if(le) le.value=email; // g·ª£i √Ω s·∫µn email
};

/* Campus pills + unlock (20k) */
const campusRow=document.getElementById('campusRow');
const defaultUnlocked=['B'];function readUnlocked(){try{return JSON.parse(localStorage.getItem('campUnlocked')||'[]')}catch{return[]}}function writeUnlocked(arr){localStorage.setItem('campUnlocked',JSON.stringify(arr))}function allUnlocked(){const a=new Set(defaultUnlocked.concat(readUnlocked()));return Array.from(a)}
const CAMPUSES=[{code:'B',label:'CS B (Free)'},{code:'A',label:'CS A'},{code:'C',label:'CS C'},{code:'D',label:'CS D'},{code:'E',label:'CS E'},{code:'H',label:'CS H'},{code:'I',label:'CS I'}];
let activeCampus='B';
function renderCampusPills(){campusRow.innerHTML='';const opened=new Set(allUnlocked());CAMPUSES.forEach(c=>{const locked=!opened.has(c.code);campusRow.insertAdjacentHTML('beforeend',`<button class="camp-pill ${locked?'locked':''} ${activeCampus===c.code?'active':''}" data-code="${c.code}">${c.label}${locked?' üîí':''}</button>`);});}
renderCampusPills();
campusRow.addEventListener('click',e=>{
  const b = e.target.closest('.camp-pill');
  if(!b) return;
  const code = b.dataset.code;
  const logged = sessionStorage.getItem('logged') === '1';

  // Y√™u c·∫ßu ƒëƒÉng nh·∫≠p n·∫øu b·∫•m c∆° s·ªü kh√°c B khi ch∆∞a ƒëƒÉng nh·∫≠p
  if(code !== 'B' && !logged){
    alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ truy c·∫≠p c∆° s·ªü n√†y!');
    openAuth();
    return;
  }

  const opened = new Set(allUnlocked());
  if(opened.has(code)){
    activeCampus = code;
    renderCampusPills();
    if (typeof renderGrid === 'function') renderGrid();
  } else {
    openCampModal(code);
  }
});
/* modal */
const campModal=document.getElementById('campModal');const campClose=document.getElementById('campClose');const selCampus=document.getElementById('selCampus');campClose.onclick=()=>campModal.style.display='none';
function openCampModal(code){selCampus.innerHTML=CAMPUSES.filter(c=>c.code!=='B').map(c=>`<option value="${c.code}" ${c.code===code?'selected':''}>${c.label}</option>`).join('');campModal.style.display='flex';}
document.getElementById('campPay').onclick=()=>{const code=selCampus.value;const cur=readUnlocked();if(!cur.includes(code))cur.push(code);writeUnlocked(cur);campModal.style.display='none';activeCampus=code;renderCampusPills();location.hash='#home';alert('M·ªü kho√° c∆° s·ªü th√†nh c√¥ng (20.000ƒë)!');};

/* Chat */
const chatLog=document.getElementById('chatLog'),chatInput=document.getElementById('chatInput'),chatSend=document.getElementById('chatSend');
function pushMsg(who,text){const w=document.createElement('div');w.className='msg'+(who==='you'?' me':'');w.innerHTML=text;chatLog.appendChild(w);chatLog.scrollTop=chatLog.scrollHeight;}
pushMsg('bot','Xin ch√†o! M√¨nh l√† AI Chatbot c·ªßa UEH Food Map ü§ñ‚ú® B·∫°n mu·ªën t√¨m m√≥n g√¨ h√¥m nay?<br><i>H√£y n√≥i: ph·ªü/c∆°m/ƒë·ªì u·ªëng‚Ä¶ ho·∫∑c ‚Äúr·∫ª‚Äù, ‚Äúg·∫ßn‚Äù.</i>');
function handleChat(m){
  m = (m||'').toLowerCase();
  // 1) X√°c ƒë·ªãnh category
  let cat = null;
  if (/(ph·ªü|b√∫n|m√¨|mi·∫øn|h·ªß ti·∫øu|bun|pho)/.test(m)) cat = 'bun';
  else if (/(c∆°m|com)/.test(m)) cat = 'com';
  else if (/(tr√† s·ªØa|tea|drink|n∆∞·ªõc|ƒë·ªì u·ªëng)/.test(m)) cat = 'drink';
  else if (/(cafe|c√† ph√™|coffee)/.test(m)) cat = 'drink';
  else if (/(chay|vegan)/.test(m)) cat = 'other';
  else if (/(g√† r√°n|hamburger|pizza|fast)/.test(m)) cat = 'fast';

  // 2) √ù ƒë·ªãnh ng∆∞·ªùi d√πng
  const wantNear  = /(g·∫ßn|g·∫ßn ƒë√¢y|ƒëi b·ªô|bao xa|near)/.test(m);
  const wantCheap = /(r·∫ª|ti·∫øt ki·ªám|gi√° th·∫•p|cheap)/.test(m);
  const wantTop   = /(top|ngon nh·∫•t|best)/.test(m);

  // 3) T·∫°o danh s√°ch ·ª©ng vi√™n
  let list = [...DATA];
  if (cat) list = list.filter(x => x.cat === cat);

  // 4) B·ªô l·ªçc theo gi√° r·∫ª
  if (wantCheap) {
    list = list.filter(x=>{
      const first = (x.price||'').toString().toLowerCase().replace(/[^0-9\-]/g,'').split('-')[0];
      const v = +first || 0; // ng∆∞·ª°ng r·∫ª ~ 35k
      return v && v <= 35000; // gi√° nh·∫≠p d·∫°ng VND ho·∫∑c "35"
    });
  }

  // 5) S·∫Øp x·∫øp: g·∫ßn nh·∫•t ho·∫∑c top theo rating (m·∫∑c ƒë·ªãnh top)
  if (wantNear) list.sort((a,b)=>parseInt(a.dist)-parseInt(b.dist));
  else list.sort((a,b)=>b.rate-a.rate);

  // 6) C·∫Øt danh s√°ch
  list = list.slice(0,3);

  // 7) T·∫°o th√¥ng ƒëi·ªáp ph√π h·ª£p ng·ªØ c·∫£nh
  if (!list.length) return 'Ch∆∞a c√≥ g·ª£i √Ω ph√π h·ª£p :(';

  let header = 'G·ª£i √Ω n√®';
  if (wantTop && !wantNear && !wantCheap) header = 'Top qu√°n ngon nh·∫•t';
  else if (wantNear && cat) header = `G·∫ßn ƒë√¢y (${cat})`; else if (wantNear) header = 'G·∫ßn ƒë√¢y';
  else if (wantCheap && cat) header = `Gi√° r·∫ª (${cat})`; else if (wantCheap) header = 'Gi√° r·∫ª n√®';
  else if (cat) header = 'G·ª£i √Ω theo lo·∫°i';

  return header + ': ' + list.map(x=>`<b>${x.name}</b> (${x.addr}, ‚òÖ${x.rate}${x.dist?`, ${x.dist}`:''})`).join(' ¬∑ ');
}
let _chatBusy=false;
function sendChat(){
  if(_chatBusy) return;               // ch·∫∑n double-trigger
  _chatBusy=true; setTimeout(()=>_chatBusy=false, 200);
  const v=chatInput.value.trim();
  if(!v){ _chatBusy=false; return; }
  pushMsg('you',v);
  chatInput.value='';
  setTimeout(()=>pushMsg('bot',handleChat(v)),250);
}
chatSend.onclick=sendChat;
chatInput.addEventListener('keydown',e=>{
  if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendChat(); }
});
document.querySelectorAll('.chip').forEach(c=>c.addEventListener('click',()=>{
  chatInput.value = c.textContent.trim();
  sendChat();
}));
</script>
<script id="reviewsInline" type="application/json">{}</script>
</body>
</html>
